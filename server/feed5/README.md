# news feed micro-service in python

## Overview

This edition of a rudimentary news feed micro-service was written in [python 3](https://www.python.org/) on [flask](http://flask.pocoo.org/).

You can read more about this project in this blog on [Python Flask vs Node.js](https://glennengstrand.info/software/performance/nodejs/python).

The controllers and the models are generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project which uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Usage

Here is how to build and run this service.

### Installation

Here are some installation steps that you will need to perform. This assumes that you already have python 3 installed. You will need to install the [MySql Connector for Python](https://pypi.python.org/pypi/mysql-connector-python/2.0.4) which was at version 2.0.4 when I developed this.

```
pip3 install -r requirements.txt
wget http://cdn.mysql.com/Downloads/Connector-Python/mysql-connector-python-2.0.4.zip#md5=3df394d89300db95163f17c843ef49df
unzip mysql-connector-python-2.0.4.zip 
cd mysql-connector-python-2.0.4
sudo /usr/local/bin/python3.6 setup.py install
```

### Running the Service

To run the service, please execute the following from the root directory of this application. Be sure to adjust the configuration file setting appropriately.

```
export APP_CONFIG=/home/glenn/git/clojure-news-feed/server/feed5/swagger_server/config-local.cfg
python3 -m swagger_server
```

### Testing the Service

Here are illustrative curl calls to test out the service. This assumes that Joe's id is 1 and Betty's id is 2.

```
curl -H "Content-Type: application/json" -d '{"name":"joe flask"}' http://localhost:8080/participant
curl -H "Content-Type: application/json" -d '{"name":"betty python"}' http://localhost:8080/participant
curl -H "Content-Type: application/json" -d '{"from":"/participant/1","to":"/participant/2"}' http://localhost:8080/participant/1/friends
curl -H "Content-Type: application/json" -d '{"from":"/participant/1","subject":"testing flask","story":"python on flask is cool"}' http://localhost:8080/participant/1/outbound
curl http://localhost:8080/participant/2/inbound
```
To see the API documentation, open http://localhost:8080/ui/ in your favorite web browser.

To launch the integration tests, use tox:
```
sudo pip install tox
tox
```

## Running on Kubernetes

How to build the image.

```bash
docker build -t feed5:1.0 .
```

See k8s/feed5-deployment.yaml for how to run this docker image.

## Load Test Results

Here are some 2 hour load test results for creating outbound posts.

| server backend | throughput | mean latency | 99th percentile |
|----------------|------------|--------------|-----------------|
| developer | 5,470 RPM | 12 ms | 25 ms |
| nginx/uWSGI | 9,909 RPM | 6 ms | 12 ms |


